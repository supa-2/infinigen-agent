# Infinigen Web 双模式功能使用指南

## 功能概述

Web 界面现在支持两种场景生成模式，你可以根据需求选择：

### 📋 模板模式（快速）
- **速度**：2-3 分钟
- **特点**：使用预生成的场景模板，自动应用颜色
- **适用**：快速生成，可以接受模板布局

### 🏗️  生成模式（预览+确认）
- **速度**：3-8 分钟（生成）+ <1秒（预览）+ 可选 ~1分钟（精修）
- **特点**：生成全新场景，先预览布局，确认后再精修渲染
- **适用**：需要独特布局的场景

## 使用步骤

### 方式一：模板模式（推荐用于快速生成）

1. 打开网页界面
2. 点击 "Let's Talk" 按钮
3. 在输入框上方，点击 **"📋 模板模式（快速，2-3分钟）"**
4. 输入场景描述，例如：
   - "生成一个红色调的北欧卧室"
   - "生成一个蓝色调的现代客厅"
5. 点击发送按钮
6. 等待 2-3 分钟，系统将：
   - 从模板池检索模板
   - 生成颜色方案
   - 应用颜色
   - 进行高质量渲染
7. 完成后查看结果，可以下载场景文件和渲染图片

### 方式二：生成模式（适合需要独特布局）

1. 打开网页界面
2. 点击 "Let's Talk" 按钮
3. 在输入框上方，点击 **"🏗️  生成模式（3-8分钟，预览+确认）"**
4. 输入场景描述，例如：
   - "生成一个现代简约风格的客厅"
   - "生成一个带有落地窗的卧室"
5. 点击发送按钮
6. 等待 3-8 分钟，系统生成场景
7. 生成完成后，会显示快速预览图（<1秒生成）
8. 你有两个选择：
   - **确认并精修渲染**：点击按钮进行 Cycles 高质量渲染（约1分钟）
   - **仅下载场景文件**：直接下载场景文件，跳过精修渲染

## 界面说明

### 模式选择按钮

在输入框上方有两个按钮：
- **📋 模板模式**：蓝色按钮，快速模式
- **🏗️  生成模式**：绿色按钮，生成模式

### 消息界面

- **用户消息**：右侧蓝色气泡
- **AI 回复**：左侧灰色气泡
- **进度显示**：实时显示生成进度和当前阶段

### 预览确认界面（生成模式）

生成模式完成后，会显示：
- 预览图片（快速预览，质量较低）
- **确认并精修渲染**按钮（绿色）
- **仅下载场景文件**链接（灰色）

### 完成结果界面

完成后显示：
- 渲染图片（模板模式：Cycles 渲染；生成模式：预览或精修渲染）
- **下载场景文件**按钮
- **下载图片**按钮

## 性能对比

| 模式 | 场景生成 | 预览 | 精修渲染 | 总耗时 |
|------|---------|------|---------|--------|
| **模板模式** | <1秒（模板） | - | ~1分钟 | **2-3分钟** |
| **生成模式（仅预览）** | 3-8分钟 | <1秒 | - | **3-8分钟** |
| **生成模式（完整）** | 3-8分钟 | <1秒 | ~1分钟 | **4-9分钟** |

## 注意事项

1. **模板池要求**：
   - 模板模式需要预先生成模板池
   - 如果没有模板池，系统会自动生成新场景（但会比较慢）
   - 生成模板池：
     ```bash
     cd /home/ubuntu/infinigen/infinigen_agent
     python tools/generate_template_pool.py --all
     ```

2. **生成时间**：
   - 场景生成需要时间，请耐心等待
   - 进度条会实时显示当前进度

3. **预览 vs 精修**：
   - 预览图：使用 Eevee 引擎，快速但质量较低，主要用于查看布局
   - 精修渲染：使用 Cycles 引擎，质量高但耗时较长

4. **网络连接**：
   - 确保前端能访问后端 API（默认: http://localhost:5000）

## 常见问题

### Q: 模板模式提示"未找到模板"
A: 需要先运行模板生成脚本：
```bash
cd /home/ubuntu/infinigen/infinigen_agent
python tools/generate_template_pool.py --all
```

### Q: 生成模式预览图质量很低
A: 预览图使用快速渲染引擎，质量较低是正常的。如需高质量图片，请点击"确认并精修渲染"。

### Q: 精修渲染失败怎么办
A: 即使精修渲染失败，场景文件和预览图仍然可用，可以直接下载使用。

### Q: 如何查看生成进度
A: 界面会实时显示进度条和当前执行的阶段，例如："正在执行: solve_rooms"

## 启动服务器

```bash
cd /home/ubuntu/infinigen/infinigen_web
python app.py
```

然后在浏览器中访问：http://localhost:5000

