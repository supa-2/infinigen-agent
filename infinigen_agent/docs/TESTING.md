# Agent 系统测试指南

## 已创建的测试脚本

### 1. `test_full_agent.py` - 完整流程测试
测试从用户输入到颜色解析的完整流程（不修改场景文件）

**运行方式：**
```bash
cd /home/ubuntu/infinigen/infinigen_agent
python3 test_full_agent.py
```

**测试内容：**
- ✓ Agent 初始化
- ✓ 大模型生成色彩方案
- ✓ 颜色解析
- ✓ 显示解析结果

### 2. `test_agent_simple.py` - 简化测试
快速测试 Agent 核心功能

**运行方式：**
```bash
python3 test_agent_simple.py
```

### 3. `quick_test_vllm.py` - vLLM 连接测试
测试 vLLM API 连接

**运行方式：**
```bash
python3 quick_test_vllm.py
```

## 完整流程测试（包含场景修改）

如果有场景文件，可以运行完整流程：

```bash
python run_agent.py "生成一个北欧风的卧室" ../outputs/hello_room/coarse/scene.blend
```

## 测试步骤

### 步骤1: 测试 vLLM 连接
```bash
python3 quick_test_vllm.py
```
预期结果：收到模型回复

### 步骤2: 测试完整 Agent 流程
```bash
python3 test_full_agent.py
```
预期结果：
- Agent 初始化成功
- 生成色彩方案（RGB 格式）
- 解析出多个家具颜色

### 步骤3: 测试完整流程（如果有场景文件）
```bash
python run_agent.py "生成一个北欧风的卧室" <场景文件路径>
```
预期结果：
- 生成带颜色的场景文件
- 输出文件：`scene_colored.blend`

## 故障排查

### 如果 vLLM 连接失败
1. 检查 `config/api_config.py` 中的 API 配置
2. 确认网络连接正常
3. 检查 API 密钥是否正确

### 如果颜色解析失败
1. 检查大模型输出格式是否符合要求
2. 查看 `src/color_parser.py` 中的解析逻辑
3. 检查是否有 RGB 值格式错误

### 如果场景修改失败
1. 确认场景文件存在且可访问
2. 确认在 Blender 环境中运行
3. 检查对象名称是否匹配

## 测试结果示例

成功的测试输出应该类似：

```
============================================================
完整 Agent 流程测试
============================================================

[步骤1] 初始化 Agent...
------------------------------------------------------------
✓ Agent 初始化成功

[步骤2] 生成色彩方案
------------------------------------------------------------
用户请求: 生成一个北欧风的卧室
正在向大模型请求色彩方案...
大模型生成的色彩方案:
1. bed: (250, 250, 250)
2. nightstand: (222, 184, 135)
...

[步骤3] 解析颜色
------------------------------------------------------------
✓ 颜色解析成功！解析到 8 个家具颜色:

  1. bed            → 北欧白          (RGB(250, 250, 250))
  2. nightstand     → 浅木色          (RGB(222, 184, 135))
  ...

============================================================
✓ 完整流程测试成功！
============================================================
```
